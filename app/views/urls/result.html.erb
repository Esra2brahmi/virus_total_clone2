<!-- Top Search Bar -->
<div class="w-full p-4 flex justify-center bg-[#1e1d2e] shadow-md">
  <div class="relative w-1/2">
    <input type="text" value="<%= params[:query] %>" class="w-full p-2 pl-10 rounded-md text-white bg-[#394568] focus:outline-none" readonly />
    <svg class="absolute left-3 top-2.5 w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 11a6 6 0 11-12 0 6 6 0 0112 0z" />
    </svg>
  </div>
</div>

<!-- Detection Score -->
<div class="max-w-5xl mx-auto mt-10 bg-[#1e1d2e] p-6 rounded-lg shadow">
  <% stats = @result.dig("attributes", "last_analysis_stats") || {} %>
  <% malicious = stats["malicious"] || 0 %>
  <% total = stats.values.sum %>
  <% percent = malicious == 0 ? 100 : [(malicious.to_f / total) * 100, 100].min.round %>
  <% ring_color = malicious == 0 ? "#22c55e" : "#ef4444" %>
  
  <div class="flex items-center gap-4">
    <div class="relative w-24 h-24 mx-auto">
      <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
        <!-- Background circle -->
        <circle
          cx="18"
          cy="18"
          r="16"
          fill="none"
          stroke="#394568"
          stroke-width="4"
        />
        <!-- Progress arc -->
        <circle
          cx="18"
          cy="18"
          r="16"
          fill="none"
          stroke="<%= ring_color %>"
          stroke-width="4"
          stroke-dasharray="100"
          stroke-dashoffset="<%= 100 - percent %>"
          stroke-linecap="round"
        />
      </svg>
      <div class="absolute inset-0 flex flex-col items-center justify-center text-white">
        <p class="text-xl font-bold"><%= malicious %></p>
        <p class="text-xs text-gray-400">/ <%= total %></p>
      </div>
    </div>
    
    <div class="flex-1">
      <h3 class="text-xl font-bold text-white">URL Analysis Results</h3>
      <% if malicious > 0 %>
        <p class="text-red-500"><%= malicious %> security vendors flagged this as malicious</p>
      <% else %>
        <p class="text-green-500">No security vendors flagged this as malicious</p>
      <% end %>
    </div>
  </div>
</div>

<!-- Tabs Navigation -->
<div class="max-w-5xl mx-auto mt-6">
  <div class="flex border-b border-[#394568] text-white">
    <button class="tab-button px-4 py-2 border-b-2 border-[#87aaf8]" data-tab="detection">Detection</button>
    <button class="tab-button px-4 py-2" data-tab="details">Details</button>
  </div>

  <!-- Tab Content -->
  <div class="bg-[#1e1d2e] p-6 rounded-b-lg shadow">
    <div id="detection" class="tab-content">
      <%= render 'urls/detection', result: @result %>
    </div>
    
    <div id="details" class="tab-content hidden">
      <%= render 'urls/details', result: @result %>
    </div>
  </div>
</div>

<script>
  // Simple tab switching
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-[#87aaf8]', 'border-b-2')
      });
      button.classList.add('border-[#87aaf8]', 'border-b-2')

      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden')
      });
      document.getElementById(button.dataset.tab).classList.remove('hidden')
    })
  })
</script>